#–ë–û–õ–¨–®–ê–Ø –ß–ê–°–¢–¨ –ö–û–î–ê –°–ì–ï–ù–ï–†–ò–†–û–í–ê–ù–ê
# –ü–æ–¥–∫–ª—é—á–∞–µ–º –Ω—É–∂–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
import telebot  # –î–ª—è —Ä–∞–±–æ—Ç—ã —Å Telegram
from ollama import chat  # –î–ª—è —Ä–∞–±–æ—Ç—ã —Å –ò–ò
# –ù–ê–°–¢–†–û–ô–ö–ò –ë–û–¢–ê
# –í—Å—Ç–∞–≤—å —Å—é–¥–∞ —Ç–æ–∫–µ–Ω —Å–≤–æ–µ–≥–æ –±–æ—Ç–∞ –æ—Ç @BotFather –≤ Telegram
TOKEN = '–ê –¢–£–¢ –¢–û–ö–ï–ù –ö–û–¢–û–†–´–ô –í–´ –°–ê–ú–ò –í–°–¢–ê–í–ò–¢–ïüòáü§úüèªü§õüèª'
# –°–æ–∑–¥–∞–µ–º –±–æ—Ç–∞
bot = telebot.TeleBot(TOKEN)
# –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç, –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–∏—à–µ—Ç /start
@bot.message_handler(commands=['start'])
def start_message(message):
    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    bot.send_message(message.chat.id, "–ü—Ä–∏–≤–µ—Ç! –ù–∞–ø–∏—à–∏ –º–Ω–µ —á—Ç–æ-–Ω–∏–±—É–¥—å, –∏ —è –æ—Ç–≤–µ—á—É —Å –ø–æ–º–æ—â—å—é –ò–ò!")
# –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç, –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ–±—ã—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
@bot.message_handler(func=lambda message: True)
def reply_to_message(message):
    # –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    user_text = message.text
    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º, —á—Ç–æ –±–æ—Ç "–ø–µ—á–∞—Ç–∞–µ—Ç"
    bot.send_chat_action(message.chat.id, 'typing')
    try:
        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –≤ –ò–ò (–º–æ–¥–µ–ª—å phi4-mini)
        response = chat(
            model='phi4-mini',  # –ù–∞–∑–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏
            messages=[{'role': 'user', 'content': '''
–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Ç–µ–∫—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –æ–ø—Ä–µ–¥–µ–ª–∏ –µ–≥–æ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—É—é –æ–∫—Ä–∞—Å–∫—É. –ò—Å–ø–æ–ª—å–∑—É–π –æ–¥–Ω–æ –∏–∑ —Å–ª–µ–¥—É—é—â–∏—Ö —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π:  
`/good` ‚Äî –ø–æ–∑–∏—Ç–∏–≤–Ω—ã–π, –¥–æ–±—Ä—ã–π, –≤–æ–æ–¥—É—à–µ–≤–ª—ë–Ω–Ω—ã–π  
`/sad` ‚Äî –≥—Ä—É—Å—Ç–Ω—ã–π, —Ä–∞–∑–æ—á–∞—Ä–æ–≤–∞–Ω–Ω—ã–π  
`/angry` ‚Äî –∑–ª–æ–π, —Ä–∞–∑–¥—Ä–∞–∂—ë–Ω–Ω—ã–π, –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π  
`/happy` ‚Äî —Å—á–∞—Å—Ç–ª–∏–≤—ã–π, —Ä–∞–¥–æ—Å—Ç–Ω—ã–π, –≤–æ–æ–¥—É—à–µ–≤–ª—ë–Ω–Ω—ã–π  
`/neutral` ‚Äî –Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π, –±–µ–∑ –≤—ã—Ä–∞–∂–µ–Ω–Ω—ã—Ö —ç–º–æ—Ü–∏–π  
–û—Ç–≤–µ—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∏–º —Å–ª–æ–≤–æ–º ‚Äî —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π —ç–º–æ—Ü–∏–µ–π.  
–¢–µ–∫—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ''' + user_text}],  # –°–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            options={
                'temperature': 0.7,  # –°–ª—É—á–∞–π–Ω–æ—Å—Ç—å –æ—Ç–≤–µ—Ç–∞ (0-1)
                'num_predict': 500   # –ú–∞–∫—Å–∏–º—É–º 500 —Å–∏–º–≤–æ–ª–æ–≤ –≤ –æ—Ç–≤–µ—Ç–µ
            }
        )
        # –ü–æ–ª—É—á–∞–µ–º –æ—Ç–≤–µ—Ç –æ—Ç –ò–ò
        ai_response = response['message']['content']
        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
        bot.send_message(message.chat.id, ai_response.replace('.', ''))
    except Exception as e:
        # –ï—Å–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞, —Å–æ–æ–±—â–∞–µ–º –æ–± —ç—Ç–æ–º
        bot.send_message(message.chat.id, "–ò–∑–≤–∏–Ω–∏, –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π –ø–æ–∑–∂–µ!")
# –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞
if __name__ == '__main__':
    print("–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω! –ü–µ—Ä–µ–π–¥–∏ –≤ Telegram –∏ –Ω–∞–ø–∏—à–∏ —Å–≤–æ–µ–º—É –±–æ—Ç—É.")
    bot.polling(none_stop=True)  # –ë–æ—Ç –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ—Å—Ç–æ—è–Ω–Ω–æ
